#!/usr/bin/env php
<?php
/**    ____                       _____ __  _      __
 *    / __ )____  ____  ____ ___ / ___// /_(_)____/ /__
 *   / __  / __ \/ __ \/ __ `__ \\__ \/ __/ / ___/ //_/
 *  / /_/ / /_/ / /_/ / / / / / /__/ / /_/ / /__/ ,<
 * /_____/\____/\____/_/ /_/ /_/____/\__/_/\___/_/|_|
 *
 * BoomStick.com - A framework for highly explosive performance
 * Copyright 2012 - 2025, BlazePHP.com
 *
 * Licensed under The MIT License
 * Any redistribution of this file's contents, both
 * as a whole, or in part, must retain the above information
 *
 * @license       MIT License (http://www.opensource.org/licenses/mit-license.php)
 * @copyright     Copyright 2012 - 2025, BlazePHP.com/BoomStick
 * @link          http://blazePHP.com/boomstick
 */
// namespace BoomStick;
require_once(dirname(__DIR__).'/init/cli.init.php');

use BoomStick\Lib\Struct;
use BoomStick\Lib\Globals as G;
use BoomStick\Lib\Debug as D;
use BoomStick\Lib\CLI\CLI;
use BoomStick\Lib\CLI\Flag;
use BoomStick\Lib\CLI\Option;
use BoomStick\Lib\CLI\Message;



G::$cli = new CLI($argc, $argv);
G::$cli->init();


Message::send('MSG: Creating route map....', Message::LEVEL_1, Message::ADD_NEW_LINE, 'white');
$routeMap = [];
$dhm = opendir(BSMODULE);
while($module = readdir($dhm)) {
	if(!in_array($module, ['.', '..']) && is_dir(BSMODULE.'/'.$module)) {
		Message::send('MSG:   Module: '.$module, Message::LEVEL_1, Message::ADD_NEW_LINE, 'yellow');
		$routeDir = BSMODULE.'/'.$module.'/route';
		if(file_exists($routeDir) && is_dir($routeDir)) {
			$dhr = opendir($routeDir);
			while($routeFile = readdir($dhr)) {
				if(preg_match('/\.route\.php$/', $routeFile)) {
					$routeFilePath = '/'.$module.'/route/'.$routeFile;
					$routeMap[] = $routeFilePath;
					Message::send('MSG:     Found ['.$routeFilePath.']', Message::LEVEL_1, Message::ADD_NEW_LINE, 'blue');
				}
			}
		}
	}
}

Message::send('MSG: Writing routes to ['.BSMODULE.'/route.map.php]: ', Message::LEVEL_1, Message::NO_NEW_LINE, 'white');
ob_start();
include(BSTEMPLATE.'/route.map.php');
$fileContents = ob_get_clean();
$fh = fopen(BSMODULE.'/route.map.php', 'w');
fwrite($fh, $fileContents);
fclose($fh);
Message::send('SUCCESS', Message::LEVEL_1, Message::ADD_NEW_LINE, 'green');